- name: 4.1.3.3 Ensure events that modify the sudo log file are collected (Automated)
  block:
    - name: 4.1.3.3 Ensure events that modify the sudo log file are collected (Automated) | Get sudo log file
      shell: grep -r logfile /etc/sudoers* | sed -e 's/.*logfile=//;s/,? .*//' -e 's/"//g'
      register: SUDO_LOG_FILE
      changed_when: false
    - name: 4.1.3.3 Ensure events that modify the sudo log file are collected (Automated) | Create or Edit Audit Rules File
      template:
        src: template_4_1_3_3.j2
        dest: /etc/audit/rules.d/50-sudo.rules
      when: SUDO_LOG_FILE_ESCAPED is defined 
    - name: Display error message if SUDO_LOG_FILE is unset
      debug:
        msg: "ERROR: Variable 'SUDO_LOG_FILE_ESCAPED' is unset."
      when: SUDO_LOG_FILE_ESCAPED is not defined 


- name: 4.1.3.1_to_14 Ensure information/events are collected (Automated)
  block:
    - name: 4.1.3.1_to_14 Ensure information/events are collected (Automated) | Create or Edit Audit Rules File
      template:
        src: '{{ item.src }}'
        dest: '{{ item.dest }}'
        #owner: root
        #group: root
        #mode: '0640'
      loop:
        - { src: 'template_4_1_3_1.j2', dest: '/etc/audit/rules.d/50-scope.rules' }
        - { src: 'template_4_1_3_2.j2', dest: '/etc/audit/rules.d/50-user_emulation.rules' }
        - { src: 'template_4_1_3_4.j2', dest: '/etc/audit/rules.d/50-time-change.rules' }
        - { src: 'template_4_1_3_5.j2', dest: '/etc/audit/rules.d/50-system_local.rules' }
        - { src: 'template_4_1_3_8.j2', dest: '/etc/audit/rules.d/50-identity.rules' }
        - { src: 'template_4_1_3_11.j2', dest: '/etc/audit/rules.d/50-session.rules' }
        - { src: 'template_4_1_3_12.j2', dest: '/etc/audit/rules.d/50-login.rules' }
        - { src: 'template_4_1_3_14.j2', dest: '/etc/audit/rules.d/50-MAC-policy.rules' }
     
